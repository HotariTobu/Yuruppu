# Feature: Event Management Tools

## Overview

イベント管理機能をツールとしてbotに追加する。ユーザーはイベントの作成、詳細取得、一覧取得が可能になる。

## Background & Purpose

Yuruppuを使用するグループでイベント（オフ会、ゲーム大会など）を企画・管理できるようにする。ユーザーはLINE上でイベントを作成し、他のメンバーがイベント情報を確認できるようにすることで、グループ活動の調整を容易にする。

## Out of Scope

- イベントの更新機能（別specで追加予定）
- イベントの削除（中止）機能（別specで追加予定）
- イベントへの参加機能（別specで追加予定）
- イベントのリマインダー通知機能
- 繰り返しイベント（週次、月次など）
- イベントへのコメント機能
- 参加費の決済・集金機能
- イベント画像のアップロード
- イベントの共同主催者機能
- 参加者へのメッセージ送信機能
- イベントカテゴリ・タグ機能
- ページネーション（初期バージョン）

## Notes

- ストレージの選定は実装フェーズ（/tech-research）で決定する
- ツールの入出力フォーマット（JSONスキーマ）は/designフェーズで決定する
- 同時実行制御の方式（楽観的ロック等）は/tech-researchフェーズで決定する

## Requirements

### Functional Requirements

#### インタラクションモデル

- [ ] FR-001: ユーザーは自然言語を通じてイベント作成・詳細取得・一覧取得ツールを呼び出せる
- [ ] FR-002: 必須フィールドが不足している場合、ツールはエラーを返す。LLMはエラー内容をもとにユーザーに不足情報を尋ねることができる

#### イベント作成

- [ ] FR-003: ユーザーはイベントを作成できる
- [ ] FR-004: 作成者は自動的にユーザー情報から取得される
- [ ] FR-005: 各イベントには作成時に一意なIDが生成される
- [ ] FR-006: イベントには以下の属性を設定する（すべて必須）
  - タイトル
  - 開始日時（作成時点より未来）
  - 終了日時（開始日時より後）
  - 定員
  - 参加費（文字列）
  - 説明（複数行テキスト）
  - 作成者を公開するかどうか

#### イベント詳細取得

- [ ] FR-007: ユーザーはイベントIDを指定して特定のイベントの詳細を取得できる

#### イベント一覧取得

- [ ] FR-008: ユーザーはイベントの一覧を取得できる
- [ ] FR-009: 作成者フィルタ: 自分が作成したイベントのみをフィルタできる
- [ ] FR-010: 期間フィルタ: 以下から1つのみ適用可能
  - 開催期間前のイベント（開始日時がツール呼び出し時点より未来）
  - 開催期間後のイベント（終了日時がツール呼び出し時点より過去）
  - 指定の日付に開催中のイベント（開始日時≤日付≤終了日時、日付はパラメータで指定）
- [ ] FR-011: 作成者フィルタと期間フィルタは組み合わせて使用できる
- [ ] FR-012: 結果は開始日時の昇順でソートされる。開始日時が同じ場合は作成日時の昇順
- [ ] FR-013: 一度の取得で最大100件のイベントが返される。超過時は最初の100件のみ返され、結果に切り捨てられたことが示される

### Non-Functional Requirements

- [ ] NFR-001: イベントデータは永続化される
- [ ] NFR-002: 作成者非公開のイベントでは、一覧表示や詳細表示で作成者情報が表示されない
- [ ] NFR-003: 複数ユーザーが同時にイベントを作成してもデータ損失が発生しない

## Acceptance Criteria

### AC-001: Create event with required fields [FR-003, FR-004, FR-005, FR-006]

- **Given**: ユーザーがbotを使用している
- **When**: ユーザーがタイトル、開始日時、終了日時を指定してイベントを作成する
- **Then**:
  - イベントが作成される
  - 作成者はリクエストしたユーザーに自動設定される
  - 一意なイベントIDが返される

### AC-002: Create event with all fields [FR-003, FR-004, FR-005, FR-006]

- **Given**: ユーザーがbotを使用している
- **When**: ユーザーがすべての属性を指定してイベントを作成する
- **Then**:
  - すべての属性が正しく保存される
  - 作成者公開フラグが設定されている場合、その情報も保存される

### AC-003: End time validation [FR-006]

- **Given**: ユーザーがイベントを作成しようとしている
- **When**: 終了日時が開始日時より前または同じ
- **Then**:
  - イベント作成は拒否される

### AC-004: Past start time validation [FR-006]

- **Given**: ユーザーがイベントを作成しようとしている
- **When**: 開始日時が作成時点より過去
- **Then**:
  - イベント作成は拒否される

### AC-005: Get event by ID [FR-007]

- **Given**: イベントが存在する
- **When**: ユーザーがイベントIDを指定して詳細を取得する
- **Then**:
  - 指定したイベントの詳細が返される

### AC-006: Get event by ID not found [FR-007]

- **Given**: 指定したIDのイベントが存在しない
- **When**: ユーザーがイベントIDを指定して詳細を取得する
- **Then**:
  - イベントが見つからないことを示すレスポンスが返される

### AC-007: List all events [FR-008, FR-012]

- **Given**: 複数のイベントが存在する
- **When**: ユーザーがフィルタなしでイベント一覧を取得する
- **Then**:
  - 全イベントが返される
  - 開始日時の昇順でソートされる
  - 作成者非公開のイベントは、作成者以外のユーザーには作成者情報が表示されない

### AC-008: List own events [FR-008, FR-009]

- **Given**: 自分と他者が作成したイベントが存在する
- **When**: ユーザーが作成者フィルタで自分のイベントのみを取得する
- **Then**:
  - 自分が作成したイベントのみが返される

### AC-009: List upcoming events [FR-008, FR-010]

- **Given**: 過去、現在開催中、未来のイベントが存在する
- **When**: ユーザーが期間フィルタ「開催期間前」を指定して一覧取得する
- **Then**:
  - 開始日時がツール呼び出し時点より未来のイベントのみが返される

### AC-010: List past events [FR-008, FR-010]

- **Given**: 過去、現在開催中、未来のイベントが存在する
- **When**: ユーザーが期間フィルタ「開催期間後」を指定して一覧取得する
- **Then**:
  - 終了日時がツール呼び出し時点より過去のイベントのみが返される

### AC-011: List events on specific date [FR-008, FR-010]

- **Given**: 過去、現在開催中、未来のイベントが存在する
- **When**: ユーザーが期間フィルタ「指定日付」（例: 2026-01-15）を指定して一覧取得する
- **Then**:
  - その日付に開催中（開始日時≤日付≤終了日時）のイベントのみが返される

### AC-012: Combined filters [FR-009, FR-010, FR-011]

- **Given**: 自分と他者が作成した、過去と未来のイベントが存在する
- **When**: ユーザーが作成者フィルタ「自分のみ」と期間フィルタ「開催期間前」を組み合わせて一覧取得する
- **Then**:
  - 自分が作成した、かつ開始日時が未来のイベントのみが返される

### AC-013: Empty list result [FR-008]

- **Given**: フィルタ条件に該当するイベントが存在しない
- **When**: ユーザーがイベント一覧を取得する
- **Then**:
  - 空のリストが返される（エラーではない）

### AC-014: Result truncation [FR-013]

- **Given**: 100件を超えるイベントが存在する
- **When**: ユーザーがイベント一覧を取得する
- **Then**:
  - 最初の100件のみが返される
  - 結果に切り捨てられたことが示される

### AC-015: Public creator shown [NFR-002]

- **Given**: 作成者公開のイベントが存在する
- **When**: ユーザーがイベント一覧または詳細を取得する
- **Then**:
  - 作成者情報が表示される

### AC-016: Anonymous creator shown as anonymous to others [NFR-002]

- **Given**: 作成者非公開のイベントが存在する
- **When**: イベント作成者以外のユーザーがイベント一覧または詳細を取得する
- **Then**:
  - 作成者情報が表示されない

## Change History

| Date | Version | Changes | Author |
|------|---------|---------|--------|
| 2026-01-10 | 1.0 | Initial version | - |
| 2026-01-10 | 1.1 | Simplify: remove event scope, timezone handling, unnecessary validations. All attributes are required. Fee is string. | - |
