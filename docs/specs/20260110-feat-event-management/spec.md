# Feature: Event Management Tools

## Overview

イベント管理機能をツールとしてbotに追加する。ユーザーはイベントの作成、詳細取得、一覧取得が可能になる。

## Background & Purpose

Yuruppuを使用するグループでイベント（オフ会、ゲーム大会など）を企画・管理できるようにする。ユーザーはLINE上でイベントを作成し、他のメンバーがイベント情報を確認できるようにすることで、グループ活動の調整を容易にする。

## Out of Scope

- イベントの更新機能（別specで追加予定）
- イベントの削除（中止）機能（別specで追加予定）
- イベントへの参加機能（別specで追加予定）
- イベントのリマインダー通知機能
- 繰り返しイベント（週次、月次など）
- イベントへのコメント機能
- 参加費の決済・集金機能
- イベント画像のアップロード
- イベントの共同主催者機能
- 参加者へのメッセージ送信機能
- イベントカテゴリ・タグ機能
- ページネーション（初期バージョン）

## Notes

- ストレージの選定は実装フェーズ（/tech-research）で決定する
- ツールの入出力フォーマット（JSONスキーマ）は/designフェーズで決定する
- 同時実行制御の方式（楽観的ロック等）は/tech-researchフェーズで決定する

## Requirements

### Functional Requirements

#### インタラクションモデル

- [ ] FR-001: ユーザーは自然言語を通じてイベント作成・詳細取得・一覧取得ツールを呼び出せる
- [ ] FR-002: 必須フィールドが不足している場合、ツールはエラーを返す。LLMはエラー内容をもとにユーザーに不足情報を尋ねることができる

#### イベント作成

- [ ] FR-003: ユーザーはイベントを作成できる
- [ ] FR-004: 作成者は自動的にユーザー情報から取得される
- [ ] FR-005: 各イベントには作成時に一意なIDが生成される
- [ ] FR-006: イベントには以下の属性を設定する（すべて必須）
  - タイトル
  - 開始日時（作成時点より未来）
  - 終了日時（開始日時より後）
  - 定員
  - 参加費（文字列）
  - 説明（複数行テキスト）
  - 作成者を公開するかどうか

#### イベント詳細取得

- [ ] FR-007: ユーザーはイベントIDを指定して特定のイベントの詳細を取得できる

#### イベント一覧取得

- [ ] FR-008: ユーザーはイベントの一覧を取得できる
- [ ] FR-009: 作成者フィルタ: 自分が作成したイベントのみをフィルタできる
- [ ] FR-010: 期間フィルタ: 以下から1つのみ適用可能
  - 開催期間前のイベント（開始日時がツール呼び出し時点より未来）
  - 開催期間後のイベント（終了日時がツール呼び出し時点より過去）
  - 指定期間に開始するイベント（指定開始日≤イベント開始日≤指定終了日、片方のみの指定も可能）
- [ ] FR-011: 作成者フィルタと期間フィルタは組み合わせて使用できる
- [ ] FR-012: 結果は開始日時の昇順でソートされる。開始日時が同じ場合は作成日時の昇順
- [ ] FR-013: 一度の取得で最大100件のイベントが返される。超過時は最初の100件のみ返され、結果に切り捨てられたことが示される
- [ ] FR-014: 一覧取得時は以下のデータを返す
  - タイトル
  - 開始日時
  - 終了日時
  - 参加費

### Non-Functional Requirements

- [ ] NFR-001: イベントデータは永続化される
- [ ] NFR-002: 作成者非公開のイベントでは、一覧表示や詳細表示で作成者情報が表示されない
- [ ] NFR-003: 複数ユーザーが同時にイベントを作成してもデータ損失が発生しない

## Acceptance Criteria

### AC-001: イベント作成 [FR-003, FR-004, FR-005, FR-006]

- **Given**: ユーザーがbotを使用している
- **When**: ユーザーがすべての属性を指定してイベントを作成する
- **Then**: イベントが作成され、一意なIDが返される

### AC-002: イベント詳細取得 [FR-007]

- **Given**: イベントが存在する
- **When**: ユーザーがイベントIDを指定して詳細を取得する
- **Then**: 指定したイベントの詳細が返される

### AC-003: イベント詳細取得（存在しない場合）[FR-007]

- **Given**: 指定したIDのイベントが存在しない
- **When**: ユーザーがイベントIDを指定して詳細を取得する
- **Then**: イベントが見つからないことを示すレスポンスが返される

### AC-004: イベント一覧取得 [FR-008, FR-012]

- **Given**: 複数のイベントが存在する
- **When**: ユーザーがイベント一覧を取得する
- **Then**: イベントが開始日時の昇順で返される

### AC-005: 作成者フィルタ [FR-009]

- **Given**: 自分と他者が作成したイベントが存在する
- **When**: ユーザーが作成者フィルタで自分のイベントのみを取得する
- **Then**: 自分が作成したイベントのみが返される

### AC-006: 期間フィルタ（開催期間前）[FR-010]

- **Given**: 過去、現在、未来のイベントが存在する
- **When**: ユーザーが期間フィルタ「開催期間前」を指定して一覧取得する
- **Then**: 開始日時が未来のイベントのみが返される

### AC-007: 期間フィルタ（開催期間後）[FR-010]

- **Given**: 過去、現在、未来のイベントが存在する
- **When**: ユーザーが期間フィルタ「開催期間後」を指定して一覧取得する
- **Then**: 終了日時が過去のイベントのみが返される

### AC-008: 期間フィルタ（指定期間）[FR-010]

- **Given**: 複数のイベントが存在する
- **When**: ユーザーが開始日または終了日を指定して一覧取得する
- **Then**: 条件に合致するイベントのみが返される

### AC-009: フィルタ組み合わせ [FR-011]

- **Given**: 自分と他者が作成したイベントが存在する
- **When**: ユーザーが作成者フィルタと期間フィルタを組み合わせて一覧取得する
- **Then**: 両方の条件に合致するイベントのみが返される

### AC-010: 作成者公開 [NFR-002]

- **Given**: 作成者公開のイベントが存在する
- **When**: ユーザーがイベント詳細を取得する
- **Then**: 作成者情報が表示される

### AC-011: 作成者非公開 [NFR-002]

- **Given**: 作成者非公開のイベントが存在する
- **When**: ユーザーがイベント詳細を取得する
- **Then**: 作成者情報が表示されない

## Change History

| Date | Version | Changes | Author |
|------|---------|---------|--------|
| 2026-01-10 | 1.0 | Initial version | - |
| 2026-01-10 | 1.1 | Simplify: remove event scope, timezone handling, unnecessary validations. All attributes are required. Fee is string. | - |
