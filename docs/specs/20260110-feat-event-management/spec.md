# Feature: Event Management Tools

## Overview

イベント管理機能をツールとしてbotに追加する。ユーザーはイベントの作成、詳細取得、一覧取得が可能になる。

## Background & Purpose

Yuruppuを使用するグループでイベント（オフ会、ゲーム大会など）を企画・管理できるようにする。ユーザーはLINE上でイベントを作成し、他のメンバーがイベント情報を確認できるようにすることで、グループ活動の調整を容易にする。

## Out of Scope

- イベントの更新機能（別specで追加予定）
- イベントの削除（中止）機能（別specで追加予定）
- イベントへの参加機能（別specで追加予定）
- イベントのリマインダー通知機能
- 繰り返しイベント（週次、月次など）
- イベントへのコメント機能
- 参加費の決済・集金機能
- イベント画像のアップロード
- イベントの共同主催者機能
- 参加者へのメッセージ送信機能
- イベントカテゴリ・タグ機能
- ページネーション（初期バージョン）

## Notes

- ストレージの選定は実装フェーズ（/tech-research）で決定する
- ツールの入出力フォーマット（JSONスキーマ）は/designフェーズで決定する
- 同時実行制御の方式（楽観的ロック等）は/tech-researchフェーズで決定する

## Requirements

### Functional Requirements

#### インタラクションモデル

- [ ] FR-001: ユーザーは自然言語を通じてイベント作成・詳細取得・一覧取得ツールを呼び出せる
- [ ] FR-002: 必須フィールドが不足している場合、ツールはエラーを返す。LLMはエラー内容をもとにユーザーに不足情報を尋ねることができる

#### イベント作成

- [ ] FR-003: ユーザーはグループチャットからのみイベントを作成できる
- [ ] FR-004: 1つのグループチャットには1つのイベントのみ存在できる。既にイベントが存在する場合はエラーを返す
- [ ] FR-005: チャットルームは作成が行われたグループチャットが自動的に紐付けられる
- [ ] FR-006: 作成者は自動的にユーザー情報から取得される
- [ ] FR-008: イベントには以下の属性を設定する（すべて必須）
  - チャットルーム（自動設定）
  - 作成者（自動設定）
  - タイトル
  - 開始日時（作成時点より未来）
  - 終了日時（開始日時より後）
  - 定員
  - 参加費（文字列）
  - 説明（複数行テキスト）
  - 作成者を公開するかどうか

#### イベント詳細取得

- [ ] FR-009: ユーザーはイベントIDを指定して特定のイベントの詳細を取得できる

#### イベント一覧取得

- [ ] FR-010: ユーザーはイベントの一覧を取得できる
- [ ] FR-011: 作成者フィルタ: 自分が作成したイベントのみをフィルタできる
- [ ] FR-012: 期間フィルタ: 以下から1つのみ適用可能
  - 開催期間前のイベント（開始日時がツール呼び出し時点より未来）
  - 開催期間後のイベント（終了日時がツール呼び出し時点より過去）
  - 指定期間に開始するイベント（指定開始日≤イベント開始日≤指定終了日、片方のみの指定も可能、両方指定時は期間が1年以内）
- [ ] FR-013: 作成者フィルタと期間フィルタは組み合わせて使用できる
- [ ] FR-014: 結果は開始日時でソートされる。開始日のみ指定または開始日と終了日の両方を指定した場合は昇順、終了日のみ指定した場合は降順
- [ ] FR-015: 開始日と終了日の両方が指定されている場合は件数制限なし。片方のみ指定の場合は最大5件
- [ ] FR-016: 一覧取得時は以下のデータを返す
  - チャットルームID
  - タイトル
  - 開始日時
  - 終了日時
  - 参加費

### Non-Functional Requirements

- [ ] NFR-001: イベントデータは永続化される
- [ ] NFR-002: 作成者非公開のイベントでは、一覧表示や詳細表示で作成者情報が表示されない
- [ ] NFR-003: 複数ユーザーが同時にイベントを作成してもデータ損失が発生しない

## Acceptance Criteria

### AC-001: イベント作成 [FR-003, FR-004, FR-005, FR-006, FR-008]

- **Given**: ユーザーがグループチャットでbotを使用しており、そのグループにイベントが存在しない
- **When**: ユーザーがすべての属性を指定してイベントを作成する
- **Then**: イベントが作成される。チャットルームと作成者が自動的に紐付けられる

### AC-002: イベント作成（グループチャット以外）[FR-003]

- **Given**: ユーザーが1対1チャットでbotを使用している
- **When**: ユーザーがイベントを作成しようとする
- **Then**: グループチャットからのみ作成可能であることを示すエラーが返される

### AC-003: イベント作成（既存イベントあり）[FR-004]

- **Given**: ユーザーがグループチャットでbotを使用しており、そのグループに既にイベントが存在する
- **When**: ユーザーがイベントを作成しようとする
- **Then**: 既にイベントが存在することを示すエラーが返される

### AC-004: イベント詳細取得 [FR-009]

- **Given**: イベントが存在する
- **When**: ユーザーがイベントIDを指定して詳細を取得する
- **Then**: 指定したイベントの詳細が返される

### AC-005: イベント詳細取得（存在しない場合）[FR-009]

- **Given**: 指定したIDのイベントが存在しない
- **When**: ユーザーがイベントIDを指定して詳細を取得する
- **Then**: イベントが見つからないことを示すレスポンスが返される

### AC-006: イベント一覧取得 [FR-010, FR-014]

- **Given**: 複数のイベントが存在する
- **When**: ユーザーがイベント一覧を取得する
- **Then**: イベントが開始日時の昇順で返される

### AC-007: 作成者フィルタ [FR-011]

- **Given**: 自分と他者が作成したイベントが存在する
- **When**: ユーザーが作成者フィルタで自分のイベントのみを取得する
- **Then**: 自分が作成したイベントのみが返される

### AC-008: 期間フィルタ（開催期間前）[FR-012]

- **Given**: 過去、現在、未来のイベントが存在する
- **When**: ユーザーが期間フィルタ「開催期間前」を指定して一覧取得する
- **Then**: 開始日時が未来のイベントのみが返される

### AC-009: 期間フィルタ（開催期間後）[FR-012]

- **Given**: 過去、現在、未来のイベントが存在する
- **When**: ユーザーが期間フィルタ「開催期間後」を指定して一覧取得する
- **Then**: 終了日時が過去のイベントのみが返される

### AC-010: 期間フィルタ（指定期間）[FR-012]

- **Given**: 複数のイベントが存在する
- **When**: ユーザーが開始日または終了日を指定して一覧取得する
- **Then**: 条件に合致するイベントのみが返される

### AC-011: フィルタ組み合わせ [FR-013]

- **Given**: 自分と他者が作成したイベントが存在する
- **When**: ユーザーが作成者フィルタと期間フィルタを組み合わせて一覧取得する
- **Then**: 両方の条件に合致するイベントのみが返される

### AC-012: 作成者公開 [NFR-002]

- **Given**: 作成者公開のイベントが存在する
- **When**: ユーザーがイベント詳細を取得する
- **Then**: 作成者情報が表示される

### AC-013: 作成者非公開 [NFR-002]

- **Given**: 作成者非公開のイベントが存在する
- **When**: ユーザーがイベント詳細を取得する
- **Then**: 作成者情報が表示されない

## Change History

| Date | Version | Changes | Author |
|------|---------|---------|--------|
| 2026-01-10 | 1.0 | Initial version | - |
| 2026-01-10 | 1.1 | Simplify: remove event scope, timezone handling, unnecessary validations. All attributes are required. Fee is string. | - |
| 2026-01-12 | 1.2 | Add chat room attribute. Events can only be created from group chats. One event per group chat. | - |
| 2026-01-12 | 1.3 | Remove FR-007 (unique ID generation). chatRoomID is the event identifier. | - |
