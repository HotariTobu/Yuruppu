# Feature: Event Update and Delete Tools

## Overview

イベントの更新と削除機能をツールとしてbotに追加する。ユーザーはイベントの内容を編集したり、イベントを削除（中止）したりできるようになる。

## Background & Purpose

既存のイベント管理機能（作成・詳細取得・一覧取得）に加えて、イベントの更新と削除機能を追加することで、イベント管理のライフサイクルを完結させる。これにより、ユーザーは予定変更や中止に柔軟に対応できるようになる。

## Out of Scope

- イベントへの参加機能（別specで追加予定）
- イベントのリマインダー通知機能
- 繰り返しイベント（週次、月次など）
- イベントへのコメント機能
- 参加費の決済・集金機能
- イベント画像のアップロード
- イベントの共同主催者機能
- 参加者へのメッセージ送信機能
- イベントカテゴリ・タグ機能
- 削除済みイベントの復元機能
- イベント変更履歴の記録
- 作成者がグループを抜けた場合の対応

## Notes

- 既存のイベントサービス（`internal/event/event.go`）に`Update`と`Delete`メソッドを追加する
- ツールの入出力フォーマット（JSONスキーマ）は/designフェーズで決定する
- 同時実行制御は既存の楽観的ロック方式を使用する

## Requirements

### Functional Requirements

#### インタラクションモデル

- [ ] FR-001: ユーザーは自然言語を通じてイベント更新・削除ツールを呼び出せる

#### イベント更新

- [ ] FR-002: ユーザーはイベントの説明を更新できる
- [ ] FR-003: 更新可能な属性は「説明」のみ（他の属性を変更したい場合は削除して再作成する運用とする）
- [ ] FR-004: イベントの作成者のみがそのイベントを更新できる
- [ ] FR-005: 更新はそのイベントが存在するグループチャットからのみ実行できる（現在のチャットルームのイベントのみが対象）
- [ ] FR-006: 現在のチャットルームにイベントが存在しない場合はエラーを返す

#### イベント削除

- [ ] FR-007: ユーザーはイベントを削除できる
- [ ] FR-008: イベントの作成者のみがそのイベントを削除できる
- [ ] FR-009: 削除はそのイベントが存在するグループチャットからのみ実行できる（現在のチャットルームのイベントのみが対象）
- [ ] FR-010: 現在のチャットルームにイベントが存在しない場合はエラーを返す
- [ ] FR-011: 削除されたイベントはストレージから物理削除され、一覧取得や詳細取得で表示されない

### Non-Functional Requirements

- [ ] NFR-001: 更新・削除操作は原子的に行われる（部分的な更新が発生しない）

## Acceptance Criteria

### AC-001: イベント説明の更新 [FR-002, FR-004, FR-005]

- **Given**: ユーザーが現在のグループチャットに自分で作成したイベントが存在する
- **When**: ユーザーが新しい説明を指定してイベントを更新する
- **Then**: イベントの説明が更新され、他の属性は変更されない

### AC-002: イベント更新（作成者以外）[FR-004]

- **Given**: 現在のグループチャットに他のユーザーが作成したイベントが存在する
- **When**: ユーザーがそのイベントを更新しようとする
- **Then**: 作成者のみが更新可能であることを示すエラーが返される

### AC-003: イベント更新（イベントが存在しない）[FR-006]

- **Given**: 現在のグループチャットにイベントが存在しない
- **When**: ユーザーがイベントを更新しようとする
- **Then**: イベントが見つからないことを示すエラーが返される

### AC-004: イベント削除（作成者による削除）[FR-007, FR-008, FR-009, FR-011]

- **Given**: ユーザーが現在のグループチャットに自分で作成したイベントが存在する
- **When**: ユーザーがイベントを削除する
- **Then**: イベントが削除され、一覧取得・詳細取得で表示されなくなる

### AC-005: イベント削除（作成者以外）[FR-008]

- **Given**: 現在のグループチャットに他のユーザーが作成したイベントが存在する
- **When**: ユーザーがそのイベントを削除しようとする
- **Then**: 作成者のみが削除可能であることを示すエラーが返される

### AC-006: イベント削除（イベントが存在しない）[FR-010]

- **Given**: 現在のグループチャットにイベントが存在しない
- **When**: ユーザーがイベントを削除しようとする
- **Then**: イベントが見つからないことを示すエラーが返される

## Change History

| Date | Version | Changes | Author |
|------|---------|---------|--------|
| 2026-01-17 | 1.0 | Initial version | - |
| 2026-01-17 | 1.1 | Simplify update to description only. Remove chat_room_id parameter - operations only work in current group chat. | - |
| 2026-01-17 | 1.2 | Remove invalid concurrent update NFR (only creator can update/delete). | - |
| 2026-01-17 | 1.3 | Clarify that deletion is hard delete (physically removed from storage). | - |
